## 给属性赋值

|                               注解                                |                                      作用                                      |
| :---------------------------------------------------------------: | :----------------------------------------------------------------------------: |
|          <font color=red>@ConfigurationProperties</font>          | <font color=red>自动读取 application.yam 中的多个属性；并给多个属性赋值</font> |
|                              @Value                               |                                 给单个属性赋值                                 |
|                     @PropertySources + @Value                     |                        指定多个外部属性文件(.property)                         |
|                     @PropertySource + @Value                      |                        指定一个外部属性文件(.property)                         |
| <font color=red>@PropertySource + @ConfigurationProperties</font> |    <font color=red>自动读取指定的文件中的多个属性；并给多个属性赋值</font>     |
|                           @Environment                            |                                 给单个属性赋值                                 |

### @ConfigurationProperties

```java
@ConfigurationProperties(prefix = "属性名")
private String 属性名;
```

### @PropertySources + @Value

```java
@PropertySources({
    @PropertySource("classpath:属性文件名1"),
    @PropertySource("classpath:属性文件名2")
})
@Value("${属性名}") // el表达式取出配置文件中属性值
private String 属性名;
```

### @PropertySource + @Value

```java
@PropertySource("classpath:属性文件名")
@Value("${属性名}") // el表达式取出配置文件中属性值
private String 属性名;
```

### @PropertySource + @ConfigurationProperties

```java
@PropertySource("classpath:属性文件名")
@ConfigurationProperties(prefix = "属性名")
private String 属性名;
```

### @Environment

```java
@Environment
private String 属性名;
```

### 具体案例

```xml
<!--给注解@ConfigurationProperties配置处理器-->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-configuration-processor</artifactId>
  <optional>true</optional>
</dependency>
```

```java
// 测试类
package com.ths;

import com.ths.pojo.Person;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class SpringBoot220ApplicationTests {
  @Autowired // 自动装配
  private Person person;
  @Test
  void contextLoads() {
    System.out.println(person);
    // Person(
    // name=张三,
    // age=18,
    // happy=true,
    // birth=Mon Sep 09 00:00:00 CST 2019,
    // books=[钢铁是怎么练成的, List和数组很像],
    // list=[钢铁是怎么练成的, List和数组很像],
    // map={name=张三, age=18},
    // dog=Dog(name=小花, age=3)
    // )
  }
}
```

```java
// Dog类
package com.ths.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@AllArgsConstructor
@Data
@NoArgsConstructor
public class Dog {
  private String firstName; // 松散绑定字段
  private String name;
  private int age;
}
```

```java
// Person类
package com.ths.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.PropertySource;
import org.springframework.stereotype.Component;

import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

// @ConfigurationProperties(application.yaml) 方式
@AllArgsConstructor
@Data
@NoArgsConstructor
@Component // 注册bean
@ConfigurationProperties(prefix = "person") // 读取配置文件 prefix：指定属性
public class Person {
  private String name;
  private int age;
  private Boolean happy;
  private Date birth;
  private String[] books;
  private List<Object> list;
  private Map<String, Object> map;
  private Dog dog;
}

// @PropertySources + @Value 方式
AllArgsConstructor
@Data
@NoArgsConstructor
@Component // 注册bean
@PropertySource(value = "classpath:yaml1.properties") // 加载指定的配置文件
public class Person {
  @Value("${name}")
  private String name;
  @Value("${age}")
  private int age;
  @Value("${happy}")
  private Boolean happy;
  @Value("${birth}")
  private Date birth;
  @Value("${books}")
  private String[] books;
  @Value("${list}")
  private List<Object> list;
  @Value("${map}")
  private String mapStr;
  private Map<String, Object> map;
  @Value("${dog}")
  private String dogStr;
  private Dog dog;
  public void init() {
    map = parseMap(mapStr);
    dog = parseDog(dogStr);
  }
  private Map<String, Object> parseMap(String str) {
    Map<String, Object> map = new HashMap<>();
    String[] pairs = str.split(", ");
    for (String pair : pairs) {
      String[] keyValue = pair.split("=");
      if (keyValue.length == 2) {
        map.put(keyValue[0], keyValue[1]);
      }
    }
    return map;
  }

  private Dog parseDog(String str) {
    Dog dog = new Dog();
    String[] pairs = str.split(", ");
    for (String pair : pairs) {
      String[] keyValue = pair.split("=");
      if (keyValue.length == 2) {
        switch (keyValue[0]) {
          case "name":
            dog.setName(keyValue[1]);
            break;
          case "age":
            dog.setAge(Integer.parseInt(keyValue[1]));
            break;
        }
      }
    }
    return dog;
  }
}

// @PropertySource + @ConfigurationProperties 方式
@Data
@NoArgsConstructor
@AllArgsConstructor
@Component
@PropertySource(value = "classpath:yaml2.properties") // 加载指定的配置文件
@ConfigurationProperties(prefix = "person") // 读取配置文件
public class Person {
  private String name;
  private int age;
  private Boolean happy;
  private Date birth;
  private String[] books;
  private List<Object> list;
  private Map<String, Object> map;
  private Dog dog;
}
```

```yaml
# application.yaml
server:
  port: 8080
person:
  # # ${}: el表达式：占位符随机数
  name: 张三${random.int}
  age: 18
  happy: true
  birth: 2019/09/09
  hello: 你好
  books:
    - 钢铁是怎么练成的
    - List和数组很像
  list:
    - 钢铁是怎么练成的
    - List和数组很像
  map: { name: 张三, age: 18 }
  dog:
    # ${...}: 这是Spring中的占位符，表示后面的内容将被解析为一个表达式。
    # ${person.hello:hello}意思是person.hello ? person.hello : “hello”
    name: ${person.hello:hello}小花
    # 松散绑定：在yaml中字段用 '-' 连接的，在实体类中这个字段可以换成驼峰式命名 fistName
    fist-name: 松散绑定
    age: 3
```

```properties
#yaml1.properties
name = 小张
age = 0
happy = true
birth = 2019/03/01
books = 钢铁是怎么练成的, List和数组很像
list = 钢铁是怎么练成的, List和数组很像
map = name=张三, age=18
dog = name=小花, age=3
```

```properties
#yaml2.properties
person.name=小张
person.age=0
person.happy=true
person.birth=2019/03/01
person.books=钢铁是怎么练成的, List和数组很像
person.list=钢铁是怎么练成的, List和数组很像
person.map={"name":"张三","age":18}
person.dog={"name":"小花","age":3}
```
