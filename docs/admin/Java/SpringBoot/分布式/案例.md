<!-- @format -->

## Dubbo+Zookeeper 案例

### 依赖

```xml
<!--dubbo-->
<dependency>
  <groupId>org.apache.dubbo</groupId>
  <artifactId>dubbo-spring-boot-starter</artifactId>
  <version>2.7.3</version>
</dependency>
<!--zookeeper客户端-->
<dependency>
  <groupId>com.github.sgroschupf</groupId>
  <artifactId>zkclient</artifactId>
  <version>0.1</version>
</dependency>
<!--zookeeper服务端的两个依赖-->
<dependency>
  <groupId>org.apache.curator</groupId>
  <artifactId>curator-framework</artifactId>
  <version>2.12.0</version>
</dependency>
<dependency>
  <groupId>org.apache.curator</groupId>
  <artifactId>curator-recipes</artifactId>
  <version>2.12.0</version>
</dependency>
<!--zookeeper服务端-->
<dependency>
  <groupId>org.apache.zookeeper</groupId>
  <artifactId>zookeeper</artifactId>
  <version>3.4.14</version>
  <!--zookeeper和log4j冲突，需要排除log4j-->
  <exclusions>
    <exclusion>
      <groupId>org.slf4j</groupId>
      <artifactId>slf4j-log4j12</artifactId>
    </exclusion>
  </exclusions>
</dependency>
```

### 生产者

```java
// 接口
package com.ths.service;

public interface TickerService {
  public String getTick();
}


// 实现类
package com.ths.service;

import org.apache.dubbo.config.annotation.Service;
import org.springframework.stereotype.Component;

@Service // 使用Dubbo的@Service注解，加上这个注解就会被扫描到，添加到注册中心
@Component // 使用了Dubbo后尽量不要使用@Service，因为Dubbo和Spring都有@Service
public class TicketServiceImpl implements TickerService{
  @Override
  public String getTick() {
    return "《我是提供数据的服务》";
  }
}
```

```properties
spring.application.name=provider-service
server.port=8001
# 提供者配置
# 服务应用的名字
dubbo.application.name=provider-service
# 注册中心地址
dubbo.registry.address=zookeeper://127.0.0.1:2181
# 哪些服务要被注册
dubbo.scan.base-packages=com.ths.service
```

### 消费者

```java
// 接口(复制生产者的)
package com.ths.service;

public interface TickerService {
  public String getTick();
}

// 实现类
package com.ths.service;

import org.apache.dubbo.config.annotation.Reference;
import org.springframework.stereotype.Service;

@Service // 这个不是Dubbo的，是给Spring的拿来用，所以是Spring的
public class StudentService {
  // 我想拿到provider-service提供的数据,需要去注册中心查找服务
  @Reference // 引用服务
  TickerService tickerService; // TickerService：远程服务接口
  public void buyTick() {
    String tick = tickerService.getTick();
    System.out.println("学生购买了：" + tick);
  }
}

// 测试类
package com.ths;

import com.ths.service.StudentService;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class ConsumerServiceApplicationTests {
  @Autowired
  StudentService studentService;
  @Test
  void contextLoads() {
    studentService.buyTick();
  }
}
```

```properties
spring.application.name=provider-service
server.port=8001
# 提供者配置
# 服务应用的名字
dubbo.application.name=provider-service
# 注册中心地址
dubbo.registry.address=zookeeper://127.0.0.1:2181
# 哪些服务要被注册
dubbo.scan.base-packages=com.ths.service
```
