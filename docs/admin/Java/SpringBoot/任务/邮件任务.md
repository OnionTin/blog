<!-- @format -->

## 邮件任务

### 1.引入依赖

```xml
<!--邮件，导入的就是javax.mail-->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-mail</artifactId>
</dependency>
```

### 2.配置文件

```properties
spring.application.name=spring-boot-2-task
spring.mail.username=2775376881@qq.com
spring.mail.password=xxxxxxxxxxxxxxxxxx
# 主机都是smtp开头
# smtp.qq.com：qq邮箱
# smtp.163.com：网易邮箱
# smtp.sina.com.cn：新浪邮箱
spring.mail.host=smtp.qq.com
# qq邮箱需要开启加密验证(其他邮箱不需要)
spring.mail.properties.mail.smtp.ssl.enable=true
```

### 3.测试类

```java
package com.ths;

import com.ths.utils.EmailUtil;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSenderImpl;
import org.springframework.mail.javamail.MimeMessageHelper;

import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;
import java.io.File;

@SpringBootTest
class SpringBoot2TaskApplicationTests {
  @Autowired
  JavaMailSenderImpl mailSender; // 邮件发送对象
  @Autowired
  EmailUtil emailUtil; // 注入 EmailUtil 实例
  // 简单邮件
  @Test
  void contextLoads1() {
    // 创建邮件对象
    SimpleMailMessage message = new SimpleMailMessage();
    // 设置邮件主题
    message.setSubject("放假通知");
    // 设置邮件发送者，需要和配置文件中的邮箱一致
    message.setFrom("2775376881@qq.com");
    // 设置邮件内容
    message.setText("放假通知，放假7天，调休3天");
    // 设置邮件接收者，可以有多个接收者，中间用逗号隔开，以下类似
    message.setTo("2775376881@qq.com");
    // 设置邮件抄送人，可以有多个抄送人
    message.setCc("2775376881@qq.com");
    mailSender.send(message);
  }

  // 复杂邮件
  @Test
  void contextLoads2() throws MessagingException {
    // 创建复杂邮件对象
    MimeMessage message = mailSender.createMimeMessage();
    // 组装信息
    MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");
    // 设置邮件主题
    helper.setSubject("放假通知");
    // 设置邮件发送者，需要和配置文件中的邮箱一致
    helper.setFrom("2775376881@qq.com");
    // 设置邮件内容
    helper.setText("<p style='color: red;'>放假通知，放假7天，调休3天</p>", true);
    // 设置邮件接收者，可以有多个接收者，中间用逗号隔开，以下类似
    helper.setTo("2775376881@qq.com");
    // 设置邮件抄送人，可以有多个抄送人
    helper.setCc("2775376881@qq.com");
    // 设置邮件附件(文件不能为空)
    helper.addAttachment("1.jpg", new File("E:\\背景\\1.jpg"));
    // 发送
    mailSender.send(message);
  }

  // 测试封装的复杂邮件发送工具类
  // 简单邮件
  @Test
  void contextLoads3() {
    String subject = "放假通知";
    String from = "2775376881@qq.com";
    String to = "2775376881@qq.com";
    String content = "放假通知，放假7天，调休3天";
    emailUtil.sendSimpleEmail(subject, from, to, content, true);
  }
  // 复杂邮件
  @Test
  void contextLoads4() throws MessagingException {
    String subject = "放假通知";
    String from = "2775376881@qq.com";
    String to = "2775376881@qq.com";
    String cc = "2775376881@qq.com";
    String content = "<p style='color: red;'>放假通知，放假7天，调休3天</p>";
    String[] attachmentPaths = {"E:\\背景\\1.jpg", "E:\\背景\\2.jpg"};

    emailUtil.sendComplexEmail(subject, from, to, cc, content, true, attachmentPaths);
  }
}
```

### 4.封装工具类

```java
package com.ths.utils;

import org.springframework.core.io.FileSystemResource;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Component;

import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;
import java.io.File;
import java.util.Arrays;
import java.util.List;

@Component
public class EmailUtil {
  // 邮件发送对象
  private final JavaMailSender mailSender;

  // 有参构造
  public EmailUtil(JavaMailSender mailSender) {
    this.mailSender = mailSender;
  }

  /**
   * 发送简单邮件
   *
   * @param subject 邮件主题
   * @param from    发送者邮箱地址
   * @param to      接收者邮箱地址（可以是单个或多个，用逗号分隔）
   * @param content 邮件内容
   * @param isHtml  是否为HTML格式
   */
  public void sendSimpleEmail(String subject, String from,
    String to, String content, boolean isHtml) {
    // 创建邮件对象
    MimeMessage message = mailSender.createMimeMessage();
    // 组装信息
    MimeMessageHelper helper = null;

    try {
      helper = new MimeMessageHelper(message, "UTF-8");

      // 设置邮件主题
      helper.setSubject(subject);

      // 设置发送者
      helper.setFrom(from);

      // 设置接收者
      List<String> toList = Arrays.asList(to.split(","));
      helper.setTo(toList.toArray(new String[0]));

      // 设置邮件内容
      helper.setText(content, isHtml);
    } catch (MessagingException e) {
      throw new RuntimeException("创建邮件消息失败", e);
    }

    try {
      mailSender.send(message);
    } catch (Exception e) {
      throw new RuntimeException("发送邮件失败", e);
    }
  }

  /**
   * 发送复杂邮件
   *
   * @param subject         邮件主题
   * @param from            发送者邮箱地址
   * @param to              接收者邮箱地址（可以是单个或多个，用逗号分隔）
   * @param cc              抄送者邮箱地址（可以是单个或多个，用逗号分隔）
   * @param content         邮件内容
   * @param isHtml          是否为HTML格式
   * @param attachmentPaths 附件路径列表（可以为空）
   */
  public void sendComplexEmail(String subject, String from, String to, String cc,
    String content, boolean isHtml, String... attachmentPaths) {
    // 创建邮件对象
    MimeMessage message = mailSender.createMimeMessage();
    // 组装信息
    MimeMessageHelper helper = null;

    try {
      helper = new MimeMessageHelper(message, true, "UTF-8");

      // 设置邮件主题
      helper.setSubject(subject);

      // 设置发送者
      helper.setFrom(from);

      // 设置接收者
      List<String> toList = Arrays.asList(to.split(","));
      helper.setTo(toList.toArray(new String[0]));

      // 设置抄送者
      if (cc != null && !cc.isEmpty()) {
        List<String> ccList = Arrays.asList(cc.split(","));
        helper.setCc(ccList.toArray(new String[0]));
      }

      // 设置邮件内容
      helper.setText(content, isHtml);

      // 添加附件
      for (String path : attachmentPaths) {
        if (path != null && !path.isEmpty()) {
          FileSystemResource file = new FileSystemResource(new File(path));
          helper.addAttachment(file.getFilename(), file);
        }
      }
    } catch (MessagingException e) {
      throw new RuntimeException("创建邮件消息失败", e);
    }

    try {
      mailSender.send(message);
    } catch (Exception e) {
      throw new RuntimeException("发送邮件失败", e);
    }
  }
}
```
