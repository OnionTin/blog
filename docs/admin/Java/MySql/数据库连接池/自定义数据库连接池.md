## 自定义数据库连接池

```java
// MyUtil
package com.api.SqlPool;

import java.sql.*;
import java.util.Properties;

public class MyUtil {
  private static String driver;
  private static String url;
  private static String username;
  private static String password;

  static {
    try {
      // 加载配置文件
      Properties p = new Properties();
      p.load(
        com.api.SqlPool.MyUtil.class.getClassLoader().getResourceAsStream(
          "jdbc.properties"
        )
      );
      System.out.println(p.getProperty("driver"));

      // 获取数据
      driver = p.getProperty("driver");
      url = p.getProperty("url");
      username = p.getProperty("username");
      password = p.getProperty("password");
      // 注册驱动
      try {
          Class.forName(driver);
      } catch (ClassNotFoundException e) {
          System.out.println("数据库连接池加载失败!");
          e.printStackTrace();
      }
    } catch (Exception e) {
      System.out.println("加载配置文件出错");
      e.printStackTrace();
    }
  }

  public static Connection getConnection() throws Exception {
    return DriverManager.getConnection(url, username, password);
  }

  public static void close(Connection conn, PreparedStatement ps, ResultSet rs) {
      if (rs != null) {
          try {
              rs.close();
          } catch (SQLException e) {
              e.printStackTrace();
          }
      }
      if (ps != null) {
          try {
              ps.close();
          } catch (SQLException e) {
              e.printStackTrace();
          }
      }
      if (conn != null) {
          try {
              conn.close();
          } catch (SQLException e) {
              e.printStackTrace();
          }
      }
  }

  public static void close(Connection conn, PreparedStatement ps) {
      close(conn, ps, null);
  }
}
```

```java
package com.api.SqlPool;

import java.sql.Connection;

// 自定义数据库连接池
public class Demo01 {
    public static void main(String[] args) {
        for (int i = 0; i < 10; i++) {
            Connection conn = MySimplePool.getConnection();
            System.out.println(conn);
            // 结果：
            // com.mysql.cj.jdbc.Driver
            // com.mysql.cj.jdbc.ConnectionImpl@6483f5ae
            // com.mysql.cj.jdbc.ConnectionImpl@b9afc07
            // com.mysql.cj.jdbc.ConnectionImpl@382db087
            // com.mysql.cj.jdbc.ConnectionImpl@73d4cc9e
            // com.mysql.cj.jdbc.ConnectionImpl@80169cf
            // Exception in thread "main" java.lang.RuntimeException:
            // 服务器忙，请稍后再试!
        }
    }
}
```

```properties
driver=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/sister?serverTimezone=UTC
username=root
password=Sap@1q2w3e4r
```
