## 预处理语句

解决 SQL 注入问题

```java
/*
 * 预处理语句的优点：
 * 1. 预编译，性能高
 * 2. 防止 SQL 注入
 * 3. PreparedStatement 是 Statement 的子类，所以方法基本都一样
 * 4. ?：占位符，可以动态传入参数
 * 5. 占位符的索引从 1 开始
 * 6. ps.set 后设置的值是什么类型，就跟什么类型就行
*/
String sql = "select * from user where username = ? and password = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, username);
ps.setString(2, password);
```

```java
// 输入姓名和密码，验证用户是否存在
package com.api.JDBC;

import java.sql.*;
import java.util.Properties;
import java.util.Scanner;

public class DemoLoginIn {
  public static void main(String[] args) throws Exception {
    // 输入姓名和密码，验证用户是否存在
    Scanner sc = new Scanner(System.in);
    System.out.println("请输入用户名");
    String name = sc.nextLine();
    System.out.println("请输入年龄");
    Integer age = sc.nextInt();

    boolean b = extracted(name, age);
    if (b) {
      System.out.println("登录成功");
    } else {
      System.out.println("登录失败");
    }
  }

  private static boolean extracted(String name, Integer age) throws SQLException {
    Properties pt = new Properties();
    pt.setProperty("user", "root");
    pt.setProperty("password", "Sap@1q2w3e4r");
    String url = "jdbc:mysql://localhost:3306/sister?serverTimezone=UTC";
    Connection conn = DriverManager.getConnection(url, pt);

    /*
    Statement sta = conn.createStatement();

    String sql = "select * from user where
    name = '" + name + "' and age = '" + age + "'";
    ResultSet rs = sta.executeQuery(sql);
    */
    String sql = "select * from user where name = ? and age = ?"
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setString(1, name);
    ps.setInt(2, age);
    ResultSet rs = ps.executeQuery();

    // 增sql语句
    /*
    String sql = "insert into user(name, age) values(?, ?)";
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setString(1, name);
    ps.setInt(2, age);
    int i = ps.executeUpdate();
    */

    // 删sql语句
    /*
    String sql = "delete from user where name = ? and age = ?";
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setString(1, name);
    ps.setInt(2, age);
    int i = ps.executeUpdate();
    */

    // 改sql语句
    /*
    String sql = "update user set name = ? where age = ?";
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setString(1, name);
    ps.setInt(2, age);
    int i = ps.executeUpdate();
    */

    boolean hasNext = rs.next();
    rs.close();
    ps.close();
    return hasNext;
  }
}
```
