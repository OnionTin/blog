<!-- @format -->

## 类组件

## 类组件技术点和概念

类组件在 React 中是通过 ES6 类定义的，它们提供了更多的功能，如生命周期方法和状态管理。

### 1. 定义类组件

类组件是通过继承`React.Component`来定义的。

```jsx
import React, { Component } from 'react';

class MyComponent extends Component {
  render() {
    return <div>Hello, {this.props.name}</div>;
  }
}
```

### 2. 构造函数

在构造函数中，可以初始化 state 和绑定方法。

```jsx
class MyComponent extends Component {
  constructor(props) {
    super(props);
    this.state = { count: 0 };
    this.handleClick = this.handleClick.bind(this);
  }

  handleClick() {
    this.setState({ count: this.state.count + 1 });
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={this.handleClick}>Click me</button>
      </div>
    );
  }
}
```

### 3. render 方法

`render`方法是类组件中唯一必须实现的方法，它返回要渲染的 React 元素。

```jsx
render() {
  return <div>{this.props.message}</div>;
}
```

### 4. 生命周期方法

类组件有多个生命周期方法，可以用来执行副作用操作或响应组件状态和 props 的变化。

#### 4.1 componentDidMount

在组件挂载后执行，通常用于执行 DOM 操作或数据获取。

```jsx
componentDidMount() {
  console.log('Component is mounted');
}
```

#### 4.2 componentDidUpdate

在组件更新后执行，可以用来处理 DOM 或执行副作用。

```jsx
componentDidUpdate(prevProps, prevState) {
  if (this.props.message !== prevProps.message) {
    console.log('Message has changed');
  }
}
```

#### 4.3 componentWillUnmount

在组件卸载前执行，通常用于清理操作，如取消网络请求或清除定时器。

```jsx
componentWillUnmount() {
  console.log('Component will unmount');
}
```

### 5. 状态管理

类组件通过`this.state`来管理内部状态。

```jsx
this.state = { count: 0 };

// 更新状态
this.setState({ count: this.state.count + 1 });
```

### 6. 默认 Props 和 PropTypes

可以使用`defaultProps`和`PropTypes`来设置默认 props 和进行 props 类型检查。

```jsx
MyComponent.propTypes = {
  message: PropTypes.string.isRequired
};

MyComponent.defaultProps = {
  message: 'Hello World'
};
```

### 7. 性能优化

可以使用`shouldComponentUpdate`来进行性能优化，避免不必要的渲染。

```jsx
shouldComponentUpdate(nextProps, nextState) {
  return this.props.message !== nextProps.message;
}
```

### 8. Context

类组件可以使用`contextType`来消费 context。

```jsx
static contextType = MyContext;

render() {
  const value = this.context;
  return <div>{value}</div>;
}
```

### 9. Refs

类组件可以使用`React.createRef`来创建 refs，并可以通过`this.ref.current`来访问 DOM 元素或组件实例。

```jsx
constructor(props) {
  super(props);
  this.myRef = React.createRef();
}

render() {
  return <div ref={this.myRef}>Hello</div>;
}
```

### 10. 错误处理

类组件可以使用静态方法`getDerivedStateFromError`和`componentDidCatch`来捕获和处理错误。

```jsx
static getDerivedStateFromError(error) {
  return { hasError: true };
}

componentDidCatch(error, info) {
  // 错误处理逻辑
}
```

### 11. 条件渲染和列表渲染

与函数组件类似，类组件也可以进行条件渲染和列表渲染。

```jsx
render() {
  const { items } = this.props;
  return (
    <ul>
      {items.map(item => (
        <li key={item.id}>{item.text}</li>
      ))}
    </ul>
  );
}
```
