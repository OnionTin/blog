<!-- @format -->

## React 中错误边界（Error Boundaries）

错误边界（Error Boundaries）是 React 中用于捕获子组件树中 JavaScript 错误并提供回退 UI 的组件，它们在渲染期间、生命周期方法和构造函数中捕获错误。

### 1. 定义错误边界

错误边界是一个 React 组件，它通过定义特定的生命周期方法来捕获子组件中的错误。

```jsx
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    // 更新 state 使下一次渲染能够显示降级后的 UI
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    // 你同样可以将错误日志上报给服务器
    logErrorToMyService(error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      // 你可以自定义降级后的 UI 并渲染
      return <h1>Something went wrong.</h1>;
    }
    return this.props.children;
  }
}
```

### 2. 使用错误边界

错误边界可以像普通组件一样使用，包裹可能抛出错误的组件。

```jsx
<ErrorBoundary>
  <MyComponent />
</ErrorBoundary>
```

### 3. 捕获错误的范围

错误边界只能捕获其子组件树中的错误，而不能捕获其自身的错误。

### 4. 错误边界的限制

错误边界不能捕获以下错误：

- 事件处理器中的错误
- 异步代码中的错误（例如 `setTimeout` 或 `requestAnimationFrame` 回调）
- 服务端渲染中的错误
- 其自身（而非子组件）中的错误

### 5. 错误处理

错误边界通过 `static getDerivedStateFromError()` 和 `componentDidCatch()` 方法来处理错误。

- `static getDerivedStateFromError()`：在渲染阶段被调用，用于更新状态以显示回退 UI。
- `componentDidCatch()`：在提交阶段被调用，可以执行副作用操作，如日志记录。

### 6. 性能考虑

错误边界可能会影响性能，因为它们增加了组件的渲染次数。

### 7. 与 Concurrent Mode 结合

错误边界可以与 React 的 Concurrent Mode 结合使用，以实现更流畅的加载体验和更好的资源调度。

### 8. 实际案例

错误边界通常用于捕获并处理应用程序中的意外错误，避免整个应用崩溃，提供更优雅的错误处理方式。
