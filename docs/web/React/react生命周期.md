## React 组件生命周期详解

### 类组件的生命周期

#### 创建阶段

| 生命周期方法        | 描述                                                             |
| ------------------- | ---------------------------------------------------------------- |
| constructor()       | 构造函数，在组件实例创建时只调用一次，用于初始化组件。           |
| render()            | 渲染方法，返回组件要渲染的内容。                                 |
| componentDidMount() | 组件挂载后调用，用于执行一些副作用操作，如数据请求、订阅事件等。 |

#### 更新阶段

| 生命周期方法                                | 描述                                                                     |
| ------------------------------------------- | ------------------------------------------------------------------------ |
| shouldComponentUpdate(nextProps, nextState) | 在组件接收到新的 props 或 state 时调用，返回布尔值决定组件是否应该更新。 |
| render()                                    | 在更新前调用，返回组件要渲染的内容。                                     |
| componentDidUpdate(prevProps, prevState)    | 在更新后调用，可以执行副作用操作，如网络请求。                           |

#### 渲染输出阶段

| 生命周期方法 | 描述                                                        |
| ------------ | ----------------------------------------------------------- |
| render()     | 渲染方法，返回组件要渲染的内容。 在创建和更新阶段都会被调用 |

#### 卸载阶段

| 生命周期方法           | 描述                                                       |
| ---------------------- | ---------------------------------------------------------- |
| componentWillUnmount() | 在组件卸载（销毁）前调用，用于清理操作，如移除事件监听器。 |

### 函数组件的生命周期

在函数组件中，可以使用 Hooks 来模拟生命周期。

#### 创建阶段

| 生命周期方法 | 描述                                                                                                 |
| ------------ | ---------------------------------------------------------------------------------------------------- |
| useState()   | 用于在函数组件中添加状态。                                                                           |
| useEffect()  | 用于处理副作用，相当于类组件的 `componentDidMount`、`componentDidUpdate` 和 `componentWillUnmount`。 |

#### 更新阶段

| 生命周期方法 | 描述                                                                                                 |
| ------------ | ---------------------------------------------------------------------------------------------------- |
| useState()   | 用于在函数组件中添加状态。                                                                           |
| useEffect()  | 用于处理副作用，相当于类组件的 `componentDidMount`、`componentDidUpdate` 和 `componentWillUnmount`。 |

#### 卸载阶段

| 生命周期方法 | 描述                                                         |
| ------------ | ------------------------------------------------------------ |
| useEffect()  | 在组件卸载时调用，用于清理副作用，如取消订阅、清除定时器等。 |

### 类组件详解

#### `constructor生命周期`：

1. 当 react 组件实例化时，是第一个运行的生命周期；
2. 在这个生命周期中，不能使用 this.setState()；
3. 在这个生命周期中，不能使用副作用(调接口、dom 操作、定时器、长连接等)；
4. 不能把 props 和 state 交叉赋值；

#### `componentDidMount生命周期`：

1.  相当于是 vue 中的 mounted
2.  它表示 DOM 结构在浏览器中渲染已完成；
3.  在这里可以使用任何的副作用；

#### `shouldComponentUpdate(nextProps,nextState)生命周期`：

1.  相当于一个开关，如果返回 true 则更新机制正常执行，如果为 false 则更新机制停止；
2.  在 vue 中是没有的；
3.  存在的意义：可以用于性能优化，但是不常用，最新的解决方案是使用 PureComponent；
4.  理论上，这个生命周期的作用，用于精细地控制声明式变量的更新问题，如果变化的声明式变量参与了视图渲染则返回 true，如果被变化的声明式变量没有直接或间接参与视图渲染，则返回 false；

#### `componentDidUpdate生命周期`：

1. 相当于 vue 中的 updated()；
2. 它表示 DOM 结构渲染更新已完成，只发生在更新阶段；
3. 在这里，可以执行大多数的副作用，但是不建议；
4. 在这里，可以使用 this.setState()，但是要有终止条件判断；

#### `componentWillUnmount生命周期`：

1. 一般在这里清除定时器、长连接等其他占用内存的构造器；

#### `render生命周期`：

1. render 是类组件中唯一必须有的生命周期，同时必须有 return（return 返回的 jsx 默认只能是单一根节点，但是在 fragment 的语法支持下，可以返回多个兄弟节点）；
2. Fragment 碎片写法: <React.Fragment></React.Fragment> 简写成<></>；
3. return 之前，可以做任意的业务逻辑，但是不能使用 this.setState()，会造成死循环；
4. render()在装载阶段和更新阶段都会运行；
5. 当 render 方法返回 null 的时候，不会影响生命周期函数的正常执行。

#### `forceUpdate`:

1. 页面强制更新,不经过 shouldComponentUpdate();

#### `componentWillReceiveProps`:

1. 在子组件内，将要接收 props 调用(第一次不会调用,更新后才开始调用，可以接收参数 props，参数是更新后的值);

#### `unmountComponentAtNode`:

1. 组件的卸载(ReactDom.unmountComponentAtNode(gocument.getElementById('...')));

#### react 新的生命周期 - react-17.0.1 开始采用

| 生命周期方法               | 描述                                                               |
| -------------------------- | ------------------------------------------------------------------ |
| getDerivedStateFromProps() | 在组件实例化后和接收到新的 props 或 state 时调用，用于更新 state。 |
| getSnapshotBeforeUpdate()  | 在组件更新前调用，用于获取更新前的快照信息。                       |

### 常见的使用场景

- **数据获取**：通常在 `componentDidMount` 或 `useEffect` 中进行数据获取。
- **订阅**：在 `componentDidMount` 或 `useEffect` 中订阅，然后在 `componentWillUnmount` 或 `useEffect` 的返回函数中取消订阅。
- **表单处理**：使用 `useState` 来管理表单状态，使用 `useEffect` 来处理表单提交后的副作用。

### 注意事项

- 尽量避免在 `render` 方法中执行重的计算或复杂的逻辑，因为这会在每次渲染时都执行。
- 尽量使用函数组件和 Hooks，因为它们更简洁，易于理解。
