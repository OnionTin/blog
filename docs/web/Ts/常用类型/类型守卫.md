## 类型守卫

> 类型守卫（Type Guards）是一种方式，用于在运行时检查和缩小变量的类型。当你在处理联合类型或交叉类型时，类型守卫特别有用，因为它们允许你在执行操作之前确定变量的确切类型。

### 基本类型守卫

> 基本类型守卫是通过使用类型谓词来实现的。类型谓词是一个表达式，它在编译时不会做任何改变，但在运行时会帮助 TypeScript 缩小变量的类型。isNumber 和 isString 函数都是类型谓词。它们返回一个布尔值，告诉 TypeScript 引擎 x 参数的类型

```ts
function isNumber(x: number | string): x is number {
  return typeof x === "number";
}

function isString(x: number | string): x is string {
  return typeof x === "string";
}
```

### 使用类型守卫

```ts
let data: number | string = Math.random() > 0.5 ? "Hello" : 10;

if (isNumber(data)) {
  console.log(data.toFixed(2)); // 这里的 data 被缩小为 number 类型
} else if (isString(data)) {
  console.log(data.toUpperCase()); // 这里的 data 被缩小为 string 类型
}
```

### 用户自定义类型守卫

> 用户自定义类型守卫通常与接口或类型别名结合使用,在这个例子中，isBird 是一个类型谓词函数，它检查 animal 是否具有 fly 方法，从而判断它是否为 Bird 类型。

```ts
interface Bird {
  fly(): void;
  layEggs(): void;
}

interface Fish {
  swim(): void;
  layEggs(): void;
}

function getAnimal(): Bird | Fish {
  return Math.random() > 0.5 ? { fly, layEggs } : { swim, layEggs };
}

function isBird(animal: Bird | Fish): animal is Bird {
  return (animal as Bird).fly !== undefined;
}
```

### 类类型守卫

> 类类型守卫是通过检查对象是否为某个类的实例来实现的,isBird 使用 instanceof 操作符来检查 animal 是否为 Bird 的实例。

```ts
class Bird {
  fly() {
    console.log("Flying");
  }
}

class Fish {
  swim() {
    console.log("Swimming");
  }
}

function getAnimal() {
  return Math.random() > 0.5 ? new Bird() : new Fish();
}

function isBird(animal: Bird | Fish): animal is Bird {
  return animal instanceof Bird;
}
```

### 在类中使用类型守卫

> 类本身也可以实现类型守卫

```ts
class Bird {
  fly() {
    console.log("Flying");
  }

  isBird() {
    return true;
  }
}

class Fish {
  swim() {
    console.log("Swimming");
  }

  isBird() {
    return false;
  }
}

function isBird(animal: Bird | Fish): animal is Bird {
  return animal.isBird();
}
```
